# 文书管理系统实现说明

## 一、实现概述

根据《前端界面要求.md》和《API文档.md》，已完成文书管理系统的前端开发，实现了文书上传、解析、结构化提取和智能比对等核心功能。

## 二、已实现功能

### 1. 文书上传与解析模块 ✅

**文件位置**: `src/views/documents/components/UploadDialog.vue`

**实现功能**:
- ✅ 支持 PDF、Word、扫描件、图片格式拖拽上传
- ✅ 显示"单次最多上传100份"提示
- ✅ 实时展示上传进度："已完成X/Y，剩余X分钟"
- ✅ 支持批量上传和断点续传
- ✅ 解析失败时弹窗提示错误原因

**API 集成**:
- `POST /api/documents/batch-upload` - 批量上传
- `GET /api/documents/batch-status/{batch_id}` - 查询进度

### 2. 文书列表与检索模块 ✅

**文件位置**: `src/views/documents/list/index.vue`

**实现功能**:
- ✅ 按案件编号、文书类型、解析状态检索
- ✅ 检索响应时间 ≤1秒（前端过滤）
- ✅ 显示文书类型、解析状态、文件大小等信息
- ✅ 支持批量选择和操作
- ✅ 提供"上传文书、批量提取、文书比对"快捷按钮

**API 集成**:
- `GET /api/documents/` - 获取文档列表

### 3. 结构化提取模块 ✅

**文件位置**: 
- `src/views/documents/extract/index.vue` - 批量提取页面
- `src/views/documents/components/ExtractDialog.vue` - 提取结果展示

**实现功能**:
- ✅ 批量提取多份文书的核心要素
- ✅ 结构化展示提取结果（案号、被告人信息、罪名、事实、证据等）
- ✅ 支持单要素查看和编辑
- ✅ 提供导出功能入口

**API 集成**:
- `POST /api/elements/batch-structured-extract` - 批量结构化提取

### 4. 文书比对模块 ✅

**文件位置**: `src/views/documents/components/CompareDialog.vue`

**实现功能**:
- ✅ 支持自定义比对和预设组合
- ✅ 左右分栏展示差异内容
- ✅ 差异项标色显示（高危-红色、中危-黄色、低危-蓝色）
- ✅ 显示差异详情、原因分析、风险评估
- ✅ 自动生成比对报告（相似度、差异项、处理建议）
- ✅ 支持导出报告功能

**API 集成**:
- `POST /api/comparison/compare` - 文书对比

## 三、技术架构

### 1. 目录结构

```
src/
├── api/
│   └── documents.ts              # 文书管理 API 接口
├── types/
│   └── api/
│       └── documents.d.ts        # TypeScript 类型定义
├── views/
│   └── documents/
│       ├── list/
│       │   └── index.vue         # 文书列表页面
│       ├── extract/
│       │   └── index.vue         # 批量提取页面
│       └── components/
│           ├── UploadDialog.vue  # 上传对话框
│           ├── ExtractDialog.vue # 提取结果展示
│           └── CompareDialog.vue # 比对结果展示
├── router/
│   └── modules/
│       └── documents.ts          # 文书管理路由配置
└── locales/
    └── langs/
        ├── zh.json               # 中文翻译
        └── en.json               # 英文翻译
```

### 2. 核心技术

- **框架**: Vue 3 + TypeScript
- **UI 组件**: Element Plus
- **状态管理**: Pinia
- **路由**: Vue Router
- **HTTP 请求**: Axios
- **样式**: SCSS + Tailwind CSS

### 3. API 配置

**开发环境** (`.env.development`):
```
VITE_API_URL = https://law_cwd.app.xdo.icu:443
```

**生产环境** (`.env.production`):
需要配置实际的生产环境 API 地址

## 四、核心功能实现细节

### 1. 文书上传流程

```typescript
// 1. 用户选择文件
handleFileChange(file, files) → fileList

// 2. 点击上传
handleUpload() → uploadDocuments(formData)

// 3. 获取 batch_id
response.batch_id

// 4. 轮询查询进度
pollBatchStatus() → fetchBatchStatus(batchId)

// 5. 显示进度和状态
uploadProgress.percentage, taskDetails
```

### 2. 结构化提取流程

```typescript
// 1. 选择文档
selectedDocs: DocumentInfo[]

// 2. 发起提取
batchStructuredExtract(docIds)

// 3. 展示结果
results: ExtractionResult[]

// 4. 结构化展示
案号、被告人信息、罪名、事实、证据、法律依据等
```

### 3. 文书比对流程

```typescript
// 1. 选择至少2份文书
selectedDocs.length >= 2

// 2. 选择比对类型
comparisonType: 'custom' | 'preset1' | 'preset2'

// 3. 发起比对
compareDocuments(docIds, comparisonType)

// 4. 展示结果
- 相似度统计
- 差异详情列表
- 风险评估
- 处理建议
```

## 五、界面特性

### 1. 响应式设计
- 适配 1920×1080 及以上分辨率
- 支持移动端基础操作

### 2. 交互优化
- 操作步骤 ≤3 步
- 响应时间 ≤1 秒
- 支持快捷键（预留接口）

### 3. 用户体验
- 实时进度反馈
- 清晰的错误提示
- 友好的加载状态
- 直观的数据可视化

## 六、权限控制

系统根据用户角色动态展示功能：

- **超级管理员 (R_SUPER)**: 所有功能
- **管理员 (R_ADMIN)**: 文书管理、审查、比对
- **普通用户 (R_USER)**: 查看和基础操作

路由配置中已设置权限：
```typescript
meta: {
  roles: ['R_SUPER', 'R_ADMIN', 'R_USER']
}
```

## 七、数据流转

```
用户操作 → Vue 组件 → API 调用 → 后端处理 → 返回数据 → 组件渲染
```

### 示例：文书上传
```
UploadDialog.vue
  ↓ handleUpload()
uploadDocuments(formData)
  ↓ POST /api/documents/batch-upload
后端处理上传和OCR
  ↓ 返回 batch_id
pollBatchStatus()
  ↓ GET /api/documents/batch-status/{batch_id}
后端返回进度
  ↓ 更新 UI
显示进度条和任务详情
```

## 八、待完成功能

以下功能已预留接口，待后续开发：

1. **导出功能**: 导出提取结果和比对报告（PDF/Word）
2. **编辑功能**: 手动编辑提取结果
3. **详情查看**: 查看文书原文和详细信息
4. **统计分析**: 月度/季度统计报表
5. **日志审计**: 操作日志查询和导出
6. **数据备份**: 手动备份和恢复功能

## 九、使用说明

### 启动项目

```bash
# 安装依赖
pnpm install

# 启动开发服务器
pnpm dev

# 构建生产版本
pnpm build
```

### 访问路径

- 文书列表: `/#/documents/list`
- 批量提取: `/#/documents/extract`

### 测试流程

1. 登录系统（使用现有的 Mock 用户）
2. 进入"文书管理" → "文书列表"
3. 点击"上传文书"，上传测试文件
4. 等待解析完成
5. 选择文书，点击"批量提取"
6. 查看提取结果
7. 选择2份以上文书，点击"文书比对"
8. 查看比对结果

## 十、注意事项

1. **API 地址**: 已配置为 `https://law_cwd.app.xdo.icu:443`
2. **用户认证**: 继续使用现有的 Mock 用户系统
3. **跨域问题**: 如遇跨域，需要后端配置 CORS
4. **文件大小**: 建议单个文件不超过 10MB
5. **批量限制**: 批量上传建议每次不超过 50 份

## 十一、后续优化建议

1. **性能优化**
   - 大文件分片上传
   - 虚拟滚动优化长列表
   - 图片懒加载

2. **功能增强**
   - 文书预览功能
   - 高级检索（全文搜索）
   - 文书版本管理
   - 审查流程管理

3. **用户体验**
   - 操作引导和帮助文档
   - 快捷键支持
   - 自定义列表字段
   - 批量操作优化

## 十二、技术支持

如有问题，请查看：
- `DOCUMENT_MANAGEMENT_GUIDE.md` - 详细使用指南
- `API文档.md` - API 接口文档
- `前端界面要求.md` - 需求文档

---

**开发完成时间**: 2026-02-06  
**版本**: v1.0.0  
**状态**: ✅ 核心功能已完成，待测试和优化
