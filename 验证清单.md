# 文书管理系统 - 验证清单

## ✅ 配置验证

### 1. 环境变量配置

- [x] `.env.development` 配置了 `VITE_API_URL = /`（Mock）
- [x] `.env.development` 配置了 `VITE_DOCUMENT_API_URL = https://law_cwd.app.xdo.icu`
- [x] `.env.development` 启用了 Mock: `VITE_USE_MOCK = true`
- [x] `.env.production` 配置了双 API 地址

### 2. 请求实例

- [x] 默认请求实例: `src/utils/http/index.ts`（用于 Mock）
- [x] 文书管理请求实例: `src/utils/http/documentRequest.ts`（用于真实后端）

### 3. API 接口

- [x] 用户认证 API (`src/api/auth.ts`) 使用默认 `request`
- [x] 文书管理 API (`src/api/documents.ts`) 使用 `documentRequest`

## 🧪 功能验证

### 启动项目

```bash
pnpm install
pnpm dev
```

### 验证步骤

#### 1. 验证用户登录（Mock）

1. 访问 `http://localhost:3006`
2. 打开浏览器开发者工具 → Network
3. 输入账号密码登录
4. 检查登录请求：
   - ✅ URL 应该是: `http://localhost:3006/api/auth/login`
   - ✅ 使用本地 Mock 数据
   - ✅ 登录成功

#### 2. 验证文书列表（真实后端）

1. 登录后进入"文书管理" → "文书列表"
2. 检查文档列表请求：
   - ✅ URL 应该是: `https://law_cwd.app.xdo.icu/api/documents/`
   - ✅ 连接真实后端
   - ✅ 返回文档列表数据

#### 3. 验证文书上传（真实后端）

1. 点击"上传文书"按钮
2. 选择或拖拽文件
3. 点击"开始上传"
4. 检查上传请求：
   - ✅ URL 应该是: `https://law_cwd.app.xdo.icu/api/documents/batch-upload`
   - ✅ Content-Type: `multipart/form-data`
   - ✅ 返回 batch_id
5. 检查进度查询请求：
   - ✅ URL 应该是: `https://law_cwd.app.xdo.icu/api/documents/batch-status/{batch_id}`
   - ✅ 实时更新进度

#### 4. 验证结构化提取（真实后端）

1. 在文书列表中选择文书
2. 点击"批量提取"
3. 检查提取请求：
   - ✅ URL 应该是: `https://law_cwd.app.xdo.icu/api/elements/batch-structured-extract`
   - ✅ 请求体包含 doc_ids
   - ✅ 返回提取结果

#### 5. 验证文书比对（真实后端）

1. 选择至少 2 份文书
2. 点击"文书比对"
3. 选择比对类型，点击"开始比对"
4. 检查比对请求：
   - ✅ URL 应该是: `https://law_cwd.app.xdo.icu/api/comparison/compare`
   - ✅ 请求体包含 doc_ids 和 comparison_type
   - ✅ 返回比对结果

## 🔍 检查清单

### 文件完整性

- [x] `src/api/documents.ts` - 文书管理 API
- [x] `src/types/api/documents.d.ts` - 类型定义
- [x] `src/utils/http/documentRequest.ts` - 文书管理请求实例
- [x] `src/views/documents/list/index.vue` - 文书列表
- [x] `src/views/documents/extract/index.vue` - 批量提取
- [x] `src/views/documents/components/UploadDialog.vue` - 上传对话框
- [x] `src/views/documents/components/ExtractDialog.vue` - 提取结果
- [x] `src/views/documents/components/CompareDialog.vue` - 比对结果
- [x] `src/router/modules/documents.ts` - 路由配置

### 路由配置

- [x] 文书管理路由已添加到 `src/router/modules/index.ts`
- [x] 路由权限配置正确: `['R_SUPER', 'R_ADMIN', 'R_USER']`
- [x] 菜单标题使用国际化: `menus.documents.*`

### 国际化

- [x] 中文翻译已添加到 `src/locales/langs/zh.json`
- [x] 英文翻译已添加到 `src/locales/langs/en.json`

### 文档完整性

- [x] `README_文书管理系统.md` - 项目总览
- [x] `快速开始.md` - 快速入门
- [x] `DOCUMENT_MANAGEMENT_GUIDE.md` - 详细使用指南
- [x] `文书管理系统实现说明.md` - 技术实现
- [x] `API配置说明.md` - API 配置详解
- [x] `API配置更新说明.md` - 配置更新记录
- [x] `项目交付清单.md` - 交付清单
- [x] `验证清单.md` - 本文档

## 🐛 常见问题排查

### 问题 1: 登录请求访问了真实后端

**症状**: 登录请求 URL 是 `https://law_cwd.app.xdo.icu/api/auth/login`

**原因**: 环境变量配置错误

**解决**:
```env
# .env.development
VITE_API_URL = /  # 确保是 / 而不是真实后端地址
```

### 问题 2: 文书管理请求使用了 Mock

**症状**: 文书列表请求 URL 是 `http://localhost:3006/api/documents/`

**原因**: API 文件使用了错误的请求实例

**解决**:
```typescript
// src/api/documents.ts
import documentRequest from '@/utils/http/documentRequest'  // 正确
// import request from '@/utils/http'  // 错误
```

### 问题 3: 文书列表有数据但不显示 ✅ 已修复

**症状**: API 返回数据，但页面列表为空

**原因**: 数据处理错误，使用了 `data.data` 而不是 `data`

**解决**: 已修复
- 修改 `src/api/documents.ts` 返回类型为 `DocumentInfo[]`
- 修改 `src/views/documents/list/index.vue` 使用 `data` 而不是 `data.data`
- 详见：`问题修复说明.md`

### 问题 4: 跨域错误

**症状**: Console 显示 CORS 错误

**原因**: 后端未配置 CORS

**解决**: 联系后端开发配置 CORS，允许前端域名访问

### 问题 5: 请求超时 ✅ 已修复

**症状**: 批量提取或文书比对 30 秒后显示 canceled

**原因**: 默认超时时间 30 秒，AI 处理需要更长时间

**解决**: 已修复
- 批量结构化提取超时时间设置为 5 分钟
- 文书比对超时时间设置为 5 分钟
- 添加用户友好的等待提示
- 详见：`超时配置说明.md`

## 📊 验证结果

### 预期结果

| 功能 | API 地址 | 状态 |
|------|---------|------|
| 用户登录 | `http://localhost:3006/api/auth/login` | ✅ Mock |
| 获取用户信息 | `http://localhost:3006/api/user/info` | ✅ Mock |
| 文书列表 | `https://law_cwd.app.xdo.icu/api/documents/` | ✅ 真实后端 |
| 文书上传 | `https://law_cwd.app.xdo.icu/api/documents/batch-upload` | ✅ 真实后端 |
| 查询进度 | `https://law_cwd.app.xdo.icu/api/documents/batch-status/{id}` | ✅ 真实后端 |
| 结构化提取 | `https://law_cwd.app.xdo.icu/api/elements/batch-structured-extract` | ✅ 真实后端 |
| 文书比对 | `https://law_cwd.app.xdo.icu/api/comparison/compare` | ✅ 真实后端 |

## ✅ 最终确认

- [ ] 项目可以正常启动
- [ ] 用户可以正常登录（使用 Mock）
- [ ] 文书列表可以正常加载（使用真实后端）
- [ ] 文书上传功能正常（使用真实后端）
- [ ] 结构化提取功能正常（使用真实后端）
- [ ] 文书比对功能正常（使用真实后端）
- [ ] 所有文档已完成
- [ ] 代码已提交

## 📝 验证签名

**验证人**: _______________

**验证日期**: _______________

**验证结果**: ⬜ 通过  ⬜ 不通过

**备注**: _______________________________________________

---

**验证完成！** ✅

如所有检查项都通过，项目即可交付使用。
