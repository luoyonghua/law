# 提取历史左右分栏功能说明

## ✅ 功能更新

提取历史详情页面已更新为左右分栏展示，左侧显示原始文件预览，右侧显示提取的结构化要素。

## 🎨 界面布局

### 左右分栏设计

```
┌─────────────────────────────────────────────────────────────┐
│                        提取详情                              │
├──────────────────────────┬──────────────────────────────────┤
│      原始文件 (50%)       │      提取要素 (50%)              │
├──────────────────────────┼──────────────────────────────────┤
│  [下载] [新窗口打开]      │  [导出要素]                       │
├──────────────────────────┼──────────────────────────────────┤
│                          │                                  │
│   PDF/Word/图片预览       │   基本信息                        │
│                          │   案件信息                        │
│                          │   被告人信息                      │
│                          │   指控罪名                        │
│                          │   事实概要                        │
│                          │   证据列表                        │
│                          │   法律依据                        │
│                          │   处理结果                        │
│                          │   特定字段                        │
│                          │                                  │
└──────────────────────────┴──────────────────────────────────┘
```

## 📋 功能特性

### 左侧面板：原始文件预览

**1. 支持的文件类型**

| 文件格式 | 预览方式 | 说明 |
|---------|---------|------|
| PDF | iframe 内嵌 | 浏览器原生预览 |
| DOC/DOCX | iframe 内嵌 | 浏览器原生预览 |
| JPG/JPEG/PNG/TIFF | 图片展示 | 响应式图片预览 |
| 其他格式 | 提示下载 | 不支持在线预览 |

**2. 操作按钮**

- ✅ **下载按钮**: 下载原始文件到本地
- ✅ **新窗口打开**: 在新标签页中打开文件

**3. 预览特性**

- ✅ PDF 文件：支持滚动、缩放
- ✅ 图片文件：自适应大小，支持查看原图
- ✅ 不支持的格式：显示友好提示和下载按钮

### 右侧面板：提取要素

**1. 卡片式布局**

每个要素独立卡片展示，包括：
- 基本信息卡片
- 案件信息卡片
- 被告人信息卡片
- 指控罪名卡片
- 事实概要卡片
- 证据列表卡片
- 法律依据卡片
- 处理结果卡片
- 特定字段卡片

**2. 滚动浏览**

- ✅ 独立滚动条
- ✅ 高度自适应
- ✅ 平滑滚动

**3. 操作按钮**

- ✅ **导出要素**: 导出结构化数据（预留）

## 🔌 API 接口

### 下载文档文件

**接口**: `GET /api/documents/{doc_id}/download`

**描述**: 根据文档ID下载原始文件流

**请求参数**:
- `doc_id`: 文档ID（路径参数）

**响应**:
- 返回文件流
- Content-Type 根据文件类型自动设置
- Content-Disposition 设置为 attachment

**前端调用**:
```typescript
// 下载文件
export function downloadDocument(docId: string) {
  const { VITE_DOCUMENT_API_URL } = import.meta.env
  return `${VITE_DOCUMENT_API_URL}/api/documents/${docId}/download`
}

// 预览文件
export function previewDocument(docId: string) {
  return downloadDocument(docId)
}
```

## 💻 技术实现

### 1. 文件预览

```vue
<!-- PDF/Office 文件 -->
<iframe
  v-if="isPdfOrOffice"
  :src="previewUrl"
  frameborder="0"
  class="preview-iframe"
/>

<!-- 图片文件 -->
<div v-else-if="isImage" class="image-preview">
  <img :src="previewUrl" alt="文档预览" />
</div>

<!-- 不支持预览 -->
<div v-else class="no-preview">
  <el-icon :size="64"><Document /></el-icon>
  <p>该文件类型不支持在线预览</p>
  <el-button type="primary" @click="handleDownload">
    下载文件
  </el-button>
</div>
```

### 2. 文件类型判断

```typescript
// 判断是否为 PDF 或 Office 文件
const isPdfOrOffice = computed(() => {
  if (!currentRecord.value) return false
  const fileName = currentRecord.value.file_name.toLowerCase()
  return fileName.endsWith('.pdf') || 
         fileName.endsWith('.doc') || 
         fileName.endsWith('.docx')
})

// 判断是否为图片
const isImage = computed(() => {
  if (!currentRecord.value) return false
  const fileName = currentRecord.value.file_name.toLowerCase()
  return fileName.endsWith('.jpg') || 
         fileName.endsWith('.jpeg') || 
         fileName.endsWith('.png') || 
         fileName.endsWith('.tiff')
})
```

### 3. 文件下载

```typescript
// 下载文件
const handleDownload = () => {
  if (!currentRecord.value) return
  const url = downloadDocument(currentRecord.value.doc_id)
  window.open(url, '_blank')
}

// 新窗口打开
const handleOpenNewTab = () => {
  if (!currentRecord.value) return
  const url = previewDocument(currentRecord.value.doc_id)
  window.open(url, '_blank')
}
```

### 4. 响应式布局

```scss
.detail-container-split {
  display: flex;
  height: calc(100vh - 120px);
  gap: 16px;

  .left-panel,
  .right-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .left-panel {
    flex: 0 0 50%;  // 左侧占 50%
  }

  .right-panel {
    flex: 0 0 50%;  // 右侧占 50%
  }
}
```

## 🎯 使用流程

### 1. 查看详情

```
历史记录列表
    ↓
点击"查看详情"
    ↓
打开全屏对话框
    ↓
左侧显示原始文件
右侧显示提取要素
```

### 2. 预览文件

```
左侧面板
    ↓
自动加载文件预览
    ↓
PDF/Office: iframe 显示
图片: 图片展示
其他: 提示下载
```

### 3. 下载文件

```
点击"下载"按钮
    ↓
调用下载 API
    ↓
浏览器自动下载文件
```

### 4. 新窗口打开

```
点击"新窗口打开"
    ↓
在新标签页打开文件
    ↓
可以使用浏览器的打印、保存等功能
```

## ✨ 功能亮点

1. **左右对比**: 原始文件和提取要素并排展示，方便对比验证
2. **在线预览**: 支持 PDF、Office、图片等常见格式在线预览
3. **全屏展示**: 使用全屏对话框，最大化显示空间
4. **独立滚动**: 左右两侧独立滚动，互不影响
5. **快捷操作**: 提供下载、新窗口打开等快捷操作
6. **卡片布局**: 右侧使用卡片式布局，结构清晰
7. **响应式设计**: 自适应不同屏幕尺寸

## 🧪 测试步骤

### 1. 测试 PDF 预览

```bash
# 选择一个 PDF 文件的记录
点击"查看详情"

# 验证
- ✅ 左侧显示 PDF 预览
- ✅ 可以滚动查看
- ✅ 右侧显示提取要素
- ✅ 下载按钮正常工作
```

### 2. 测试 Word 预览

```bash
# 选择一个 Word 文件的记录
点击"查看详情"

# 验证
- ✅ 左侧显示 Word 预览
- ✅ 格式正确显示
- ✅ 新窗口打开正常
```

### 3. 测试图片预览

```bash
# 选择一个图片文件的记录
点击"查看详情"

# 验证
- ✅ 左侧显示图片
- ✅ 图片自适应大小
- ✅ 可以查看原图
```

### 4. 测试不支持的格式

```bash
# 选择一个 TXT 或其他格式的记录
点击"查看详情"

# 验证
- ✅ 显示"不支持在线预览"提示
- ✅ 显示下载按钮
- ✅ 点击下载正常工作
```

## 📊 对比展示效果

### 修改前

```
┌─────────────────────────────────┐
│          提取详情                │
├─────────────────────────────────┤
│  基本信息                        │
│  结构化数据                      │
│  被告人信息                      │
│  指控罪名                        │
│  ...                            │
│                                 │
│  [导出] [关闭]                   │
└─────────────────────────────────┘
```

### 修改后

```
┌─────────────────────────────────────────────┐
│              提取详情（全屏）                 │
├──────────────────┬──────────────────────────┤
│   原始文件       │      提取要素             │
│   [下载] [打开]   │      [导出]              │
├──────────────────┼──────────────────────────┤
│                  │                          │
│  PDF/图片预览     │   📋 基本信息            │
│                  │   📋 案件信息            │
│                  │   📋 被告人信息          │
│                  │   📋 指控罪名            │
│                  │   📋 事实概要            │
│                  │   📋 证据列表            │
│                  │   📋 法律依据            │
│                  │   📋 处理结果            │
│                  │   📋 特定字段            │
│                  │                          │
└──────────────────┴──────────────────────────┘
```

## 🎨 界面优化

### 1. 视觉层次

- 使用卡片式布局，每个要素独立展示
- 卡片标题使用灰色背景，突出层次
- 内容区域使用白色背景，清晰易读

### 2. 颜色标识

- 指控罪名：红色标签（danger）
- 法律依据：黄色标签（warning）
- 处理结果：蓝色高亮背景
- 验证状态：绿色/灰色标签

### 3. 交互优化

- 左右面板独立滚动
- 右侧使用 el-scrollbar 组件
- 平滑滚动效果
- 响应式布局

## 📝 待完善功能

1. **文件标注**: 在预览时支持标注和批注
2. **对比模式**: 支持多个版本的提取结果对比
3. **打印功能**: 支持打印原始文件和提取要素
4. **全屏预览**: 左侧文件支持全屏查看
5. **缩放控制**: PDF 预览支持缩放控制
6. **页码跳转**: PDF 预览支持页码跳转

## ✅ 实现完成

提取历史左右分栏功能已完整实现，提供了更好的对比查看体验！

---

**更新时间**: 2026-02-06  
**状态**: ✅ 已完成  
**特性**: 左右分栏、文件预览、独立滚动
